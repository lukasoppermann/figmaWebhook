# Name of the action visible in the action overview
name: Figma release
# this triggers the action when a post to "https://api.github.com/repos/:username/:repo/dispatches" comes in
on:
  repository_dispatch:
    type: figma-release
env:
  payload: ${{toJSON(github.event.client_payload.release)}}
jobs:
  build:
    # the name for the entire job
    name: Create new primer/figma release
    # we run this on ubuntu, leave this alone, if you don't have a good reason to change it
    runs-on: ubuntu-latest
    steps:
      # this lets us work in the actual repository
      - uses: actions/checkout@v2
      # if the folder named ".changeset" does not exist, create it

      - name: mkdir ".changeset" directory
        # change tokens here (and in line 32) if you want to use a differently named folder
        run: "mkdir -p .changeset"
      # this creates a json file from the stringified json from the request body

      - name: create changeset
        run: |
          echo "${{ github.event.client_payload.releaseNote }}" > "${{ github.event.client_payload.fileInfo.fileName }}-${{ github.event.client_payload.fileInfo.timestamp }}.md"

      - name: commit to base branch
        uses: stefanzweifel/git-auto-commit-action@v4
        with:
          commit_message: "added changeset for ${{ github.event.client_payload.fileInfo.fileName }}-${{ github.event.client_payload.fileInfo.timestamp }}.md"
          branch: main
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
